<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .connected {
            background: #d4edda;
            color: #155724;
        }
        .disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        .connecting {
            background: #fff3cd;
            color: #856404;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        input[type="text"] {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
    </style>
</head>
<body>
    <h1>WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    
    <div id="status" class="status disconnected">ğŸ”´ ì—°ê²°ë˜ì§€ ì•ŠìŒ</div>
    
    <div class="controls">
        <input type="text" id="workspace" placeholder="ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„" value="test-workspace">
        <input type="text" id="channel" placeholder="ì±„ë„ ì´ë¦„" value="general">
        <button class="btn-primary" onclick="connect()">ì—°ê²°</button>
        <button class="btn-danger" onclick="disconnect()">ì—°ê²° í•´ì œ</button>
    </div>
    
    <div class="controls">
        <input type="text" id="message" placeholder="ë©”ì‹œì§€ ì…ë ¥" value="ì•ˆë…•í•˜ì„¸ìš”!">
        <button class="btn-primary" onclick="sendMessage()">ë©”ì‹œì§€ ì „ì†¡</button>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>
    
    <h3>ì—°ê²° ë¡œê·¸:</h3>
    <div id="log" class="log"></div>

    <script>
        let websocket = null;
        let isConnected = false;

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(status, message) {
            const statusElement = document.getElementById('status');
            statusElement.className = `status ${status}`;
            statusElement.textContent = message;
        }

        function connect() {
            const workspace = document.getElementById('workspace').value;
            const channel = document.getElementById('channel').value;
            
            if (!workspace || !channel) {
                alert('ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì™€ ì±„ë„ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const wsUrl = `ws://localhost:8000/ws/${workspace}/${channel}?token=dev-token`;
            
            log(`ì—°ê²° ì‹œë„: ${wsUrl}`);
            updateStatus('connecting', 'ğŸŸ¡ ì—°ê²° ì¤‘...');

            try {
                websocket = new WebSocket(wsUrl);
                
                websocket.onopen = function(event) {
                    log('âœ… WebSocket ì—°ê²° ì„±ê³µ');
                    updateStatus('connected', 'ğŸŸ¢ ì—°ê²°ë¨');
                    isConnected = true;
                };
                
                websocket.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    log(`ğŸ“¨ ë©”ì‹œì§€ ìˆ˜ì‹ : ${JSON.stringify(data, null, 2)}`);
                };
                
                websocket.onclose = function(event) {
                    log(`âŒ WebSocket ì—°ê²° ì¢…ë£Œ: ${event.code} - ${event.reason}`);
                    updateStatus('disconnected', 'ğŸ”´ ì—°ê²° ëŠê¹€');
                    isConnected = false;
                };
                
                websocket.onerror = function(error) {
                    log(`âŒ WebSocket ì˜¤ë¥˜: ${error}`);
                    updateStatus('disconnected', 'ğŸ”´ ì—°ê²° ì˜¤ë¥˜');
                    isConnected = false;
                };
                
            } catch (error) {
                log(`âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
                updateStatus('disconnected', 'ğŸ”´ ì—°ê²° ì‹¤íŒ¨');
            }
        }

        function disconnect() {
            if (websocket) {
                websocket.close();
                websocket = null;
                isConnected = false;
                log('ì—°ê²° í•´ì œë¨');
            }
        }

        function sendMessage() {
            if (!websocket || !isConnected) {
                alert('WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const messageText = document.getElementById('message').value;
            if (!messageText.trim()) {
                alert('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const message = {
                type: 'message',
                content: messageText,
                message_type: 'text',
                mentions: []
            };

            try {
                websocket.send(JSON.stringify(message));
                log(`ğŸ“¤ ë©”ì‹œì§€ ì „ì†¡: ${JSON.stringify(message, null, 2)}`);
            } catch (error) {
                log(`âŒ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: ${error.message}`);
            }
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            log('WebSocket í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            log('ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”: python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000');
        });

        // Enter í‚¤ë¡œ ë©”ì‹œì§€ ì „ì†¡
        document.getElementById('message').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html> 