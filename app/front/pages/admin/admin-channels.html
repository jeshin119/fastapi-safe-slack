<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„ë„ ê´€ë¦¬ - WorkSpace</title>
    
    <!-- CSS íŒŒì¼ë“¤ ì„í¬íŠ¸ -->
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/admin-channels.css">
</head>
<body>
    <!-- ë°°ê²½ ì¥ì‹ -->
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>

    <div class="admin-container">
        <!-- í—¤ë” -->
        <div class="header-section">
            <div class="admin-badge">ğŸ‘‘ ê´€ë¦¬ì</div>
            <div class="logo">ğŸŒŠ</div>
            <h1 class="welcome-text">ì±„ë„ ê´€ë¦¬</h1>
            <p class="subtitle">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  ì±„ë„ì„<br>ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <!-- ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ -->
        <div class="workspace-info">
            <div class="workspace-icon">ğŸš€</div>
            <div class="workspace-details">
                <div class="workspace-name">ë¡œë”© ì¤‘</div>
                <div class="workspace-meta">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
        </div>

        <!-- í†µê³„ ì„¹ì…˜ -->
        <div class="stats-section">
            <div class="section-title">ğŸ“Š ì±„ë„ í˜„í™©</div>
            <div class="stats-grid">

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);">ğŸŒ</div>
                    <div class="stat-number">-</div>
                    <div class="stat-label">ê³µê°œ ì±„ë„</div>
                    <div class="stat-change neutral">ë¡œë”© ì¤‘</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">ğŸ”’</div>
                    <div class="stat-number">-</div>
                    <div class="stat-label">ë¹„ê³µê°œ ì±„ë„</div>
                    <div class="stat-change neutral">ë¡œë”© ì¤‘</div>
                </div>
            </div>
        </div>

        <!-- ì±„ë„ ìƒì„± í¼ -->
        <div class="create-channel-form" id="create-form">
            <div class="form-header">
                <div class="form-title">ìƒˆ ì±„ë„ ë§Œë“¤ê¸°</div>
                <div class="form-description">ìƒˆë¡œìš´ ì±„ë„ì„ ìƒì„±í•˜ì—¬ íŒ€ ì†Œí†µì„ í™œì„±í™”í•˜ì„¸ìš”</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="channel-name">
                    ì±„ë„ ì´ë¦„ <span style="color: #ef4444;">*</span>
                </label>
                <input 
                    type="text" 
                    id="channel-name" 
                    class="form-input" 
                    placeholder="ì˜ˆ: ì¼ë°˜, ê°œë°œíŒ€, í”„ë¡œì íŠ¸-A"
                    maxlength="50"
                >
            </div>


            <div class="form-checkbox-group">
                <input type="checkbox" id="is-private" class="form-checkbox">
                <label for="is-private" class="checkbox-label">
                    ğŸ”’ ë¹„ê³µê°œ ì±„ë„ (ì´ˆëŒ€ë°›ì€ ë©¤ë²„ë§Œ ì°¸ì—¬ ê°€ëŠ¥)
                </label>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="cancelCreateChannel()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="createChannel()">
                    <div class="loading-spinner" id="create-spinner"></div>
                    <span id="create-btn-text">ì±„ë„ ë§Œë“¤ê¸°</span>
                </button>
            </div>
        </div>

        <!-- íƒ­ ì„¹ì…˜ -->
        <div class="tab-section">


            <!-- í™œì„± ì±„ë„ íƒ­ -->
            <div class="tab-content active" id="active-content">
                <div class="content-header">
                    <input type="text" class="search-input" placeholder="ì±„ë„ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." id="channel-search">
                    <select class="filter-select" id="channel-filter">
                        <option value="all">ëª¨ë“  ì±„ë„</option>
                        <option value="public">ê³µê°œ ì±„ë„</option>
                        <option value="private">ë¹„ê³µê°œ ì±„ë„</option>
                    </select>
                    
                </div>

                <div class="channels-grid" id="channels-list">
                    <div class="loading-state">
                        <div class="loading-spinner-large"></div>
                        <div>ì±„ë„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- í™•ì¸ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="confirm-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon" id="modal-icon">âš ï¸</div>
                <div class="modal-title" id="modal-title">ì‘ì—… í™•ì¸</div>
                <div class="modal-description" id="modal-description">ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" id="confirm-btn" onclick="confirmAction()">
                    <div class="loading-spinner" id="modal-spinner"></div>
                    <span id="confirm-text">í™•ì¸</span>
                </button>
            </div>
        </div>
    </div>

    <!-- API ì„¤ì • - config.js ë¨¼ì € ë¡œë“œ -->
    <script src="/static/js/config.js"></script>
    
    <script>
        // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ë¡œë“œ í•¨ìˆ˜ ì¶”ê°€
      // ğŸ†• ë¡œë”© ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
    function showWorkspaceLoading() {
        const iconElement = document.querySelector('.workspace-icon');
        const nameElement = document.querySelector('.workspace-name');
        const metaElement = document.querySelector('.workspace-meta');
        
        iconElement.innerHTML = '<div class="loading-spinner-small"></div>';
        nameElement.textContent = 'ë¡œë”© ì¤‘...';
        metaElement.textContent = 'ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...';
    }

    // ğŸ†• ì›Œí¬ìŠ¤í˜ì´ìŠ¤ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateWorkspaceUI(workspace) {
        const iconElement = document.querySelector('.workspace-icon');
        const nameElement = document.querySelector('.workspace-name');
        const metaElement = document.querySelector('.workspace-meta');
        
        // ì•„ì´ì½˜ ì„¤ì • (APIì—ì„œ ì•„ì´ì½˜ ì •ë³´ê°€ ìˆë‹¤ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
        const workspaceIcon = workspace.icon || getDefaultWorkspaceIcon(workspace.name);
        iconElement.textContent = workspaceIcon;
        
        // ì´ë¦„ ì„¤ì •
        nameElement.textContent = workspace.name;
        
        // ë©”íƒ€ ì •ë³´ ì„¤ì •
        const memberText = `${workspace.member_count || 0}ëª…ì˜ ë©¤ë²„`;
        const roleText = workspace.is_workspace_admin ? 'ê´€ë¦¬ì' : 'ë©¤ë²„';
        metaElement.textContent = `${memberText} â€¢ ${roleText}`;
    }

    // ğŸ†• ê¸°ë³¸ ì•„ì´ì½˜ ìƒì„± í•¨ìˆ˜
    function getDefaultWorkspaceIcon(workspaceName) {
        // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì— ë”°ë¼ ë‹¤ë¥¸ ì•„ì´ì½˜ ë°˜í™˜
        const iconMap = {
            'admin': 'ğŸ‘‘',
            'dev': 'ğŸ’»',
            'design': 'ğŸ¨',
            'marketing': 'ğŸ“¢',
            'startup': 'ğŸš€',
            'team': 'ğŸ‘¥'
        };
        
        // ì´ë¦„ì— í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ì•„ì´ì½˜ ì‚¬ìš©
        for (const [keyword, icon] of Object.entries(iconMap)) {
            if (workspaceName.toLowerCase().includes(keyword)) {
                return icon;
            }
        }
        
        // ê¸°ë³¸ ì•„ì´ì½˜
        return 'ğŸ¢';
    }

    // ğŸ†• ì—ëŸ¬ ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
    function showWorkspaceError() {
        const iconElement = document.querySelector('.workspace-icon');
        const nameElement = document.querySelector('.workspace-name');
        const metaElement = document.querySelector('.workspace-meta');
        
        iconElement.textContent = 'âš ï¸';
        nameElement.textContent = 'ì—°ê²° ì‹¤íŒ¨';
        metaElement.innerHTML = `
            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ 
            <button onclick="loadWorkspaceInfo()" style="margin-left: 8px; padding: 2px 8px; border: none; background: #2196f3; color: white; border-radius: 4px; cursor: pointer;">
                ğŸ”„ ì¬ì‹œë„
            </button>
        `;
    }


    // API ì„¤ì • - config.jsì—ì„œ API_BASE_URL ì‚¬ìš©
    // API_BASE_URLì€ config.jsì—ì„œ ìë™ìœ¼ë¡œ ì„¤ì •ë¨
    let currentAction = null;
    let targetChannel = null;

    // ğŸ”§ ê°œì„ ëœ ì´ˆê¸°í™” - ìˆœì„œ ì¤‘ìš”!
    document.addEventListener('DOMContentLoaded', async function() {
        // localStorageì—ì„œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê°€ì ¸ì˜¤ê¸°
        const workspaceName = localStorage.getItem("current_workspace_name");
        
        // UI ì—…ë°ì´íŠ¸
        document.querySelector('.workspace-name').textContent = workspaceName || "ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì—†ìŒ";
        document.querySelector('.workspace-meta').textContent = "ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´";

        
        // ì±„ë„ ë¡œë“œ
        loadChannels();
        
        setupSearch();
        setupFormValidation();
    });
        // ì±„ë„ ëª©ë¡ ë¡œë“œ
        async function loadChannels() {
    try {
        const workspaceName = localStorage.getItem("current_workspace_name");
        const token = localStorage.getItem('access_token');
        const response = await fetch(`${API_BASE_URL}/channels/list`, {
            method: 'POST',  // ğŸ†• POSTë¡œ ë³€ê²½
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                workspace_name: workspaceName  // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ ì „ì†¡
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const channels = await response.json();
        
        // ë°°ì—´ì¸ì§€ í™•ì¸
        if (Array.isArray(channels)) {
            renderChannelCards(channels);  
            updateChannelStats(channels);
        } else {
            console.error('channelsê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', channels);
            throw new Error('ì˜ëª»ëœ ë°ì´í„° í˜•ì‹');
        }
        
    } catch (error) {
        console.error('ì±„ë„ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        showLoadError();
    }
}
      

        // ë¡œë“œ ì—ëŸ¬ í‘œì‹œ
        function showLoadError() {
            const channelsList = document.getElementById('channels-list');
            channelsList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">âš ï¸</div>
                    <div class="empty-title">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-description">
                        ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.<br>
                        <button class="btn btn-primary" onclick="loadChannels()" style="margin-top: 12px;">
                            ğŸ”„ ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                </div>
            `;
            
            // í†µê³„ë¥¼ ì—ëŸ¬ ìƒíƒœë¡œ ì„¤ì •
            const statNumbers = document.querySelectorAll('.stat-number');
            const statChanges = document.querySelectorAll('.stat-change');
            
            statNumbers.forEach(stat => stat.textContent = 'ì˜¤ë¥˜');
            statChanges.forEach(change => {
                change.textContent = 'ì—°ê²° ì‹¤íŒ¨';
                change.className = 'stat-change neutral';
            });
            
            const workspaceMeta = document.querySelector('.workspace-meta');
            if (workspaceMeta) {
                workspaceMeta.textContent = 'ë°ì´í„° ì—°ê²° ì‹¤íŒ¨ - ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”';
            }
        }

        // ì±„ë„ ì¹´ë“œ ë Œë”ë§
        function renderChannelCards(channels) {
            const container = document.getElementById('channels-list');
            if (!channels || channels.length === 0) {
                container.innerHTML = `<div class="empty-state">ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤</div>`;
                return;
            }

            container.innerHTML = channels.map(channel => `
        <div class="channel-card" data-channel-id="${channel.channel_id}">
            <div class="channel-header">
                <div class="channel-icon ${channel.is_public ? 'public' : 'private'}">
                    ${channel.is_public ? '#' : 'ğŸ”’'}
                </div>
                <div class="channel-info">
                    <div class="channel-name">${channel.name}</div>
                    <div class="channel-status">
                        <span class="status-badge ${channel.is_public ? 'status-public' : 'status-private'}">
                            ${channel.is_public ? 'ğŸŒ ê³µê°œ ì±„ë„' : 'ğŸ”’ ë¹„ê³µê°œ ì±„ë„'}
                        </span>
                    </div>
                </div>
            </div>
            <div class="channel-actions">
                <button class="action-btn action-delete" onclick="deleteChannel(${channel.channel_id}, '${channel.name}')">
                    ğŸ—‘ï¸ ì‚­ì œ
                </button>
            </div>
        </div>
    `).join('');
}

        // ì±„ë„ í†µê³„ ì—…ë°ì´íŠ¸ (ì‹¤ì œ ë°ì´í„° ê¸°ë°˜)
        function updateChannelStats(channels) {
            if (!channels || !Array.isArray(channels)) return;
            
            // í†µê³„ ê³„ì‚°
            const publicCount = channels.filter(ch => ch.is_public).length;
            const privateCount = channels.filter(ch => !ch.is_public).length;
            
            // DOM ì—…ë°ì´íŠ¸
            const statNumbers = document.querySelectorAll('.stat-number');
            const statChanges = document.querySelectorAll('.stat-change');
            
            // ê³µê°œ ì±„ë„ ìˆ˜ (ì²« ë²ˆì§¸ ì¹´ë“œ)
            if (statNumbers[0]) {
                statNumbers[0].textContent = publicCount;
            }
            
            // ë¹„ê³µê°œ ì±„ë„ ìˆ˜ (ë‘ ë²ˆì§¸ ì¹´ë“œ)
            if (statNumbers[1]) {
                statNumbers[1].textContent = privateCount;
            }
            
            // ë¹„ìœ¨ ê³„ì‚° ë° í‘œì‹œ
            const totalChannels = channels.length;
            
            if (statChanges[0]) {
                const publicRate = totalChannels > 0 ? ((publicCount / totalChannels) * 100).toFixed(1) : 0;
                statChanges[0].textContent = `${publicRate}%`;
                statChanges[0].className = 'stat-change positive';
            }
            
            if (statChanges[1]) {
                const privateRate = totalChannels > 0 ? ((privateCount / totalChannels) * 100).toFixed(1) : 0;
                statChanges[1].textContent = `${privateRate}%`;
                statChanges[1].className = 'stat-change neutral';
            }
            
            // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë©”íƒ€ ì •ë³´ë„ ì—…ë°ì´íŠ¸
            const workspaceMeta = document.querySelector('.workspace-meta');
            if (workspaceMeta && !workspaceMeta.textContent.includes('ë©¤ë²„')) {
                workspaceMeta.textContent += ` â€¢ ì´ ${totalChannels}ê°œ ì±„ë„`;
            }
        }

        // ì±„ë„ ìƒíƒœ ë°°ì§€ ìƒì„±
        function getChannelStatusBadge(channel) {
            if (channel.is_public) {
                return '<span class="status-badge status-public">ğŸŒ ê³µê°œ ì±„ë„</span>';
            } else {
                return '<span class="status-badge status-private">ğŸ”’ ë¹„ê³µê°œ ì±„ë„</span>';
            }
        }

        // ì±„ë„ ë©”íƒ€ ì •ë³´ ìƒì„±
        function getChannelMetaInfo(channel) {
            const metaItems = [];
            
            metaItems.push(`
                <div class="meta-row">
                    <span class="meta-label">ë©¤ë²„ ìˆ˜</span>
                    <span class="meta-value">ğŸ‘¥ ${channel.member_count || 0}ëª…</span>
                </div>
            `);

            metaItems.push(`
                <div class="meta-row">
                    <span class="meta-label">ë©”ì‹œì§€ ìˆ˜</span>
                    <span class="meta-value">ğŸ’¬ ${(channel.message_count || 0).toLocaleString()}ê°œ</span>
                </div>
            `);

            metaItems.push(`
                <div class="meta-row">
                    <span class="meta-label">ìƒì„±ì¼</span>
                    <span class="meta-value">ğŸ“… ${new Date(channel.created_at).toLocaleDateString('ko-KR')}</span>
                </div>
            `);

            metaItems.push(`
                <div class="meta-row">
                    <span class="meta-label">ë§ˆì§€ë§‰ í™œë™</span>
                    <span class="meta-value">ğŸ•’ ${channel.last_activity || 'í™œë™ ì—†ìŒ'}</span>
                </div>
            `);

            return metaItems.join('');
        }

        // ì±„ë„ ì•¡ì…˜ ë²„íŠ¼ ìƒì„±
        function getChannelActions(channel) {
            const actions = [
                `<button class="action-btn action-members" onclick="manageMembers(${channel.id}, '${channel.name}')">
                    ğŸ‘¥ ë©¤ë²„
                </button>`
            ];

            // ê¸°ë³¸ ì±„ë„(ì „ì²´, ê³µì§€ì‚¬í•­)ì´ ì•„ë‹Œ ê²½ìš° ì‚­ì œë§Œ ê°€ëŠ¥
            if (channel.name !== 'ì „ì²´' && channel.name !== 'ê³µì§€ì‚¬í•­') {
                actions.push(`
                    <button class="action-btn action-delete" onclick="deleteChannel(${channel.id}, '${channel.name}')">
                        ğŸ—‘ï¸ ì‚­ì œ
                    </button>
                `);
            }

            return actions.join('');
        }

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-content`).classList.add('active');
        }

        // ì±„ë„ ì•¡ì…˜ í•¨ìˆ˜ë“¤
      

        function manageMembers(channelId, channelName) {
            showAlert(`ğŸ‘¥ "${channelName}" ì±„ë„ ë©¤ë²„ ê´€ë¦¬ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.`);
        }

       

        async function deleteChannel(channelId, channelName) {
            currentAction = 'delete';
            targetChannel = { id: channelId, name: channelName };
            
            showModal(
                'ğŸ—‘ï¸',
                'ì±„ë„ ì‚­ì œ',
                `"${channelName}" ì±„ë„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ëª¨ë“  ë©”ì‹œì§€ì™€ íŒŒì¼ì´ ì‚­ì œë©ë‹ˆë‹¤.`,
                'ì‚­ì œí•˜ê¸°'
            );
        }

        // ëª¨ë‹¬ ê´€ë¦¬
        function showModal(icon, title, description, confirmText) {
            document.getElementById('modal-icon').textContent = icon;
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-description').textContent = description;
            document.getElementById('confirm-text').textContent = confirmText;
            document.getElementById('confirm-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('confirm-modal').style.display = 'none';
            currentAction = null;
            targetChannel = null;
        }

        async function confirmAction() {
    if (!currentAction || !targetChannel) return;

    const confirmBtn = document.getElementById('confirm-btn');
    const confirmText = document.getElementById('confirm-text');
    const spinner = document.getElementById('modal-spinner');

    confirmBtn.disabled = true;
    confirmText.textContent = 'ì²˜ë¦¬ ì¤‘...';
    spinner.style.display = 'inline-block';

    try {
        let result;
        
        // archive ì¼€ì´ìŠ¤ ì œê±°, deleteë§Œ ë‚¨ê¹€
        if (currentAction === 'delete') {
            result = await deleteChannelAPI(targetChannel.id);
        } else {
            result = { success: false, error: 'ì•Œ ìˆ˜ ì—†ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.' };
        }

        if (result.success) {
            showAlert(`ğŸ—‘ï¸ "${targetChannel.name}" ì±„ë„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            
            const channelCard = document.querySelector(`[data-channel-id="${targetChannel.id}"]`);
            if (channelCard) {
                channelCard.style.animation = 'fadeOut 0.3s ease-out forwards';
                setTimeout(() => {
                    channelCard.remove();
                }, 300);
            }
            
            closeModal();
            // í†µê³„ ë‹¤ì‹œ ë¡œë“œ
            loadChannels();
        } else {
            showAlert(`âŒ ì˜¤ë¥˜: ${result.error}`);
        }
    } catch (error) {
        showAlert('âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
        confirmBtn.disabled = false;
        confirmText.textContent = 'ì‚­ì œí•˜ê¸°';
        spinner.style.display = 'none';
    }
}

        // API í•¨ìˆ˜ë“¤
        async function deleteChannelAPI(channelId) {
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE_URL}/channels/${encodeURIComponent(targetChannel.name)}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    return { success: true };
                } else {
                    const data = await response.json();
                    return { success: false, error: data.detail || 'ì±„ë„ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' };
                }
            } catch (error) {
                return { success: false, error: 'ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' };
            }
        }

        // ê¸°íƒ€ ê¸°ëŠ¥ë“¤
        function exportChannels() {
            showAlert('ğŸ“¤ ì±„ë„ ëª©ë¡ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        function setupSearch() {
            const searchInput = document.getElementById('channel-search');
            const filterSelect = document.getElementById('channel-filter');
            
            if (searchInput) {
                searchInput.addEventListener('input', filterChannels);
            }
            
            if (filterSelect) {
                filterSelect.addEventListener('change', filterChannels);
            }
        }

        function filterChannels() {
            const searchTerm = document.getElementById('channel-search').value.toLowerCase();
            const filterType = document.getElementById('channel-filter').value;
            const channelCards = document.querySelectorAll('#channels-list .channel-card');
            
            channelCards.forEach(card => {
                const name = card.querySelector('.channel-name').textContent.toLowerCase();
                const channelIcon= card.querySelector('.channel-icon');
                const isPublic = channelIcon.classList.contains('public');
                
                let matchesSearch = name.includes(searchTerm) ;
                
                
                let matchesFilter = true;
                
                if (filterType === 'public') {
                    matchesFilter = isPublic;
                } else if (filterType === 'private') {
                    matchesFilter = !isPublic;
                }
                
                if (matchesSearch && matchesFilter) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // í¼ ê²€ì¦
        function setupFormValidation() {
            document.getElementById('channel-name').addEventListener('input', function() {
                const createBtn = document.querySelector('#create-form .btn-primary');
                createBtn.disabled = this.value.trim().length < 2;
            });
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.getElementById('confirm-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                
                const createForm = document.getElementById('create-form');
                if (createForm.classList.contains('active')) {
                    cancelCreateChannel();
                }
            }
        });
    </script>
</body>
</html>
