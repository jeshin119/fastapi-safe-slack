<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì • - WorkSpace</title>
     <!-- CSS íŒŒì¼ë“¤ ì„í¬íŠ¸ -->
     <link rel="stylesheet" href="/static/css/common.css">
     <link rel="stylesheet" href="/static/css/workspace-settings.css">
    
</head>
<body>
    <!-- ë°°ê²½ ì¥ì‹ -->
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>

    <div class="admin-container">
        <!-- ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ -->
        <div class="workspace-info">
            <div class="workspace-icon">ğŸš€</div>
            <div class="workspace-details">
                <div class="workspace-name" id="display-workspace-name">ë¡œë”© ì¤‘...</div>
                <div class="workspace-meta" id="display-workspace-meta">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                
                
                <!-- ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„ íƒê¸° -->
                <div id="workspace-selector" style="margin-top: 12px; display: none;">
                    <select id="workspace-select" style="
                        padding: 8px 12px; 
                        border: 2px solid #e2e8f0; 
                        border-radius: 8px; 
                        background: white;
                        font-size: 14px;
                        cursor: pointer;
                        min-width: 200px;
                    " onchange="switchWorkspace()">
                        <!-- ì˜µì…˜ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </select>
                </div>
            </div>
        </div>

        <!-- íƒ­ ì„¹ì…˜ -->
        <div class="tab-section">
            <!-- íƒ­ ë²„íŠ¼ -->
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('general')" id="general-tab">
                    ğŸ“ ì¼ë°˜ ì„¤ì •
                </button>
                <button class="tab-button" onclick="switchTab('invite')" id="invite-tab">
                    ğŸ« ì´ˆëŒ€ ê´€ë¦¬
                </button>
                <button class="tab-button" onclick="switchTab('danger')" id="danger-tab">
                    âš ï¸ ìœ„í—˜ êµ¬ì—­
                </button>
            </div>

            <!-- ì¼ë°˜ ì„¤ì • íƒ­ -->
            <div class="tab-content active" id="general-content">
                <div class="settings-section">
                    <div class="section-header">
                        <div class="section-title">
                            ğŸ“ ê¸°ë³¸ ì •ë³´
                        </div>
                        <div class="section-description">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ ê¸°ë³¸ ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„</label>
                        <input type="text" class="form-input" placeholder="ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" id="workspace-name" />
                        <div class="form-help">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì€ ëª¨ë“  ë©¤ë²„ì—ê²Œ í‘œì‹œë©ë‹ˆë‹¤.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì„¤ëª…</label>
                        <textarea class="form-textarea" id="workspace-description" placeholder="ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                        <div class="form-help">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ ëª©ì ê³¼ ë¬¸í™”ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.</div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="loadWorkspaceInfo()">ì·¨ì†Œ</button>
                        <button class="btn btn-primary" onclick="saveGeneralSettings()">
                            <div class="loading-spinner" id="general-spinner" style="display: none;"></div>
                            ğŸ’¾ ì €ì¥
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì´ˆëŒ€ ê´€ë¦¬ íƒ­ -->
            <div class="tab-content" id="invite-content">
                <div class="settings-section">
                    <div class="section-header">
                        <div class="section-title">
                            ğŸ« ìƒˆ ì´ˆëŒ€ ì½”ë“œ ìƒì„±
                        </div>
                        <div class="section-description">ìƒˆë¡œìš´ ë©¤ë²„ë¥¼ ì´ˆëŒ€í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„</label>
                        <input type="text" class="form-input" id="invite-workspace-name" placeholder="ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
                        <div class="form-help">ì´ ì´ë¦„ìœ¼ë¡œ ì´ˆëŒ€ ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ë§Œë£Œì¼ (ì„ íƒì‚¬í•­)</label>
                        <input type="datetime-local" class="form-input" id="invite-expires-at" />
                        <div class="form-help">ë¹„ì›Œë‘ë©´ ë¬´ì œí•œìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateInviteCode()">
                            <div class="loading-spinner" id="invite-spinner" style="display: none;"></div>
                            ğŸ« ì´ˆëŒ€ ì½”ë“œ ìƒì„±
                        </button>
                    </div>

                    <!-- ìƒì„±ëœ ì´ˆëŒ€ ì½”ë“œ í‘œì‹œ -->
                    <div class="invite-section" id="generated-invite-section" style="display: none; margin-top: 24px;">
                        <div class="invite-header">
                            <div class="invite-title">ìƒì„±ëœ ì´ˆëŒ€ ì½”ë“œ</div>
                            <button class="btn btn-secondary" onclick="copyInviteCode()">ğŸ“‹ ë³µì‚¬</button>
                        </div>
                        <div class="invite-display">
                            <input type="text" class="invite-code" readonly id="generated-invite-code" />
                        </div>
                        <div class="form-help" id="invite-code-info"></div>
                    </div>
                </div>

                <!-- ê¸°ì¡´ ì´ˆëŒ€ ì½”ë“œ ëª©ë¡ -->
                <div class="settings-section">
                    <div class="section-header">
                        <div class="section-title">
                            ğŸ“‹ ê¸°ì¡´ ì´ˆëŒ€ ì½”ë“œ ëª©ë¡
                        </div>
                        <div class="section-description">ìƒì„±ëœ ì´ˆëŒ€ ì½”ë“œë“¤ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì¡°íšŒí•  ì›Œí¬ìŠ¤í˜ì´ìŠ¤</label>
                        <input type="text" class="form-input" id="list-workspace-name" placeholder="ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
                        <button class="btn btn-secondary" onclick="loadInviteCodes()" style="margin-top: 8px;">
                            <div class="loading-spinner" id="list-spinner" style="display: none;"></div>
                            ğŸ” ì½”ë“œ ëª©ë¡ ì¡°íšŒ
                        </button>
                    </div>

                    <div id="invite-codes-container" style="margin-top: 20px;">
                        <!-- ì´ˆëŒ€ ì½”ë“œ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>

            <!-- ìœ„í—˜êµ¬ì—­ íƒ­ -->
            <div class="tab-content" id="danger-content">
                <div class="settings-section">
                    <div class="section-header">
                        <div class="section-title">
                            âš ï¸ ìœ„í—˜ êµ¬ì—­
                        </div>
                        <div class="section-description">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‚­ì œì™€ ê°™ì€ ìœ„í—˜í•œ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                    </div>

                    <div class="danger-zone">
                        <div class="danger-title">
                            ğŸ—‘ï¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‚­ì œ
                        </div>
                        <div class="danger-description">
                            ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚­ì œí•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                        <button class="btn btn-danger" onclick="deleteWorkspace()">ğŸ—‘ï¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‚­ì œ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // ì „ì—­ ë³€ìˆ˜ (window ê°ì²´ì— ì €ì¥í•˜ì—¬ íƒ­ ê°„ ê³µìœ )
        // ============================
        window.API_BASE_URL = window.API_BASE_URL || 'http://localhost:8000';
        window.userData = window.userData || null;
        window.currentWorkspaceName = window.currentWorkspaceName || '';
        window.availableWorkspaces = window.availableWorkspaces || [];

        // ============================
        // ì´ˆê¸°í™”
        // ============================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì • í˜ì´ì§€ ì´ˆê¸°í™”');
            
            try {
                // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
                await loadUserInfo();
                
                // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ë¡œë“œ (API ì‹¤íŒ¨í•´ë„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì§„í–‰)
                await loadWorkspaceInfo();
                
                console.log('âœ… í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                // ìµœì•…ì˜ ê²½ìš° ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
                updateWorkspaceDisplay('ê¸°ë³¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤', 'ê´€ë¦¬ì', new Date().toLocaleDateString('ko-KR'), 'ws_default');
            }
        });

        // ============================
        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
        // ============================
        async function loadUserInfo() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/login.html';
                return;
            }

            try {
                // JWT í† í°ì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
                const tokenData = JSON.parse(atob(token.split('.')[1]));
                userData = {
                    id: tokenData.user_id,
                    email: tokenData.user_email,
                    name: tokenData.user_name
                };
                
                // window ê°ì²´ì—ë„ ì €ì¥
                window.userData = userData;
                
                console.log('ğŸ‘¤ ì‚¬ìš©ì ì •ë³´:', userData);
                
                // ê¸°ë³¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ ì„¤ì •
                currentWorkspaceName = `${userData.name}ì˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤`;
                window.currentWorkspaceName = currentWorkspaceName;
                
            } catch (error) {
                console.error('í† í° íŒŒì‹± ì˜¤ë¥˜:', error);
                alert('ì¸ì¦ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                localStorage.removeItem('access_token');
                window.location.href = '/login.html';
            }
        }

        // ============================
        // API í˜¸ì¶œ ê³µí†µ í•¨ìˆ˜
        // ============================
        async function apiCall(endpoint, options = {}) {
            const token = localStorage.getItem('access_token');
            
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (response.status === 401) {
                    alert('ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    localStorage.removeItem('access_token');
                    window.location.href = '/login.html';
                    return null;
                }

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error(`API í˜¸ì¶œ ì‹¤íŒ¨ (${endpoint}):`, error);
                throw error;
            }
        }
        // ============================
        // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ë¡œë“œ (ìˆ˜ì •ëœ ë²„ì „)
        // ============================
        async function loadWorkspaceInfo() {
            try {
                console.log('ğŸš€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ë¡œë“œ ì‹œì‘');
                
                // URLì—ì„œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
                const urlParams = new URLSearchParams(window.location.search);
                const targetWorkspace = urlParams.get('workspace');
                console.log('ğŸ¯ ëŒ€ìƒ ì›Œí¬ìŠ¤í˜ì´ìŠ¤:', targetWorkspace);
                
                // API í˜¸ì¶œ: ì‚¬ìš©ìê°€ ì†í•œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                const workspaces = await apiCall('/workspaces/workspaces_list', {
                    method: 'GET'
                });
                
                console.log('ğŸ“‹ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ëª©ë¡:', workspaces);
                
                // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ê°€ ì—†ëŠ” ê²½ìš°
                if (!workspaces || workspaces.length === 0) {
                    console.log('âš ï¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ê°€ ì—†ì–´ ê¸°ë³¸ê°’ ì‚¬ìš©');
                    showDefaultWorkspace();
                    return;
                }
                
                // í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì°¾ê¸°
                let currentWorkspace = null;
                
                if (targetWorkspace) {
                    // URL íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì°¾ê¸°
                    currentWorkspace = workspaces.find(ws => ws.name === targetWorkspace);
                    console.log('ğŸ” URL íŒŒë¼ë¯¸í„°ë¡œ ì°¾ì€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤:', currentWorkspace);
                }
                
                if (!currentWorkspace) {
                    // URL íŒŒë¼ë¯¸í„°ê°€ ì—†ê±°ë‚˜ ë§¤ì¹­ ì‹¤íŒ¨ì‹œ ì²« ë²ˆì§¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤
                    currentWorkspace = workspaces[0];
                    console.log('ğŸ“Œ ì²« ë²ˆì§¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„ íƒ:', currentWorkspace);
                }
                
                // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ì—…ë°ì´íŠ¸
                setupCurrentWorkspace(currentWorkspace, workspaces);
                
                console.log('âœ… ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ ì‹¤íŒ¨:', error);
                handleWorkspaceLoadError(error);
            }
        }
        // ============================
        // ê¸°ë³¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í‘œì‹œ
        // ============================
        function showDefaultWorkspace() {
            const workspaceName = currentWorkspaceName || `${userData?.name || 'ì‚¬ìš©ì'}ì˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤`;
            const workspaceId = `ws_${userData?.id || Date.now()}`;
            
            updateWorkspaceDisplay(
                workspaceName,
                userData?.name || 'ì•Œ ìˆ˜ ì—†ìŒ',
                new Date().toLocaleDateString('ko-KR'),
                workspaceId,
                1,
                true
            );
            
            console.log('ğŸ  ê¸°ë³¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì •:', workspaceName);
        }
        // ============================
        // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ ì—ëŸ¬ ì²˜ë¦¬
        // ============================
        function handleWorkspaceLoadError(error) {
            console.log('ğŸ”„ ì—ëŸ¬ ë°œìƒ, ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤');
            
            const workspaceName = currentWorkspaceName || `${userData?.name || 'ì‚¬ìš©ì'}ì˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤`;
            const workspaceId = `ws_${userData?.id || Date.now()}`;
            
            updateWorkspaceDisplay(
                workspaceName,
                userData?.name || 'ì•Œ ìˆ˜ ì—†ìŒ',
                new Date().toLocaleDateString('ko-KR'),
                workspaceId,
                1,
                true
            ); console.warn('âš ï¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.');
        }

        // ============================
        // í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì • (ê¸°ì¡´ setupRealWorkspaceData ëŒ€ì²´)
        // ============================
        function setupCurrentWorkspace(selectedWorkspace, allWorkspaces) {
            console.log('ğŸ¯ ì„ íƒëœ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì •:', selectedWorkspace);
            
            // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
            availableWorkspaces = allWorkspaces;
            window.availableWorkspaces = allWorkspaces;
            currentWorkspaceName = selectedWorkspace.name;
            window.currentWorkspaceName = selectedWorkspace.name;
            
            // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„ íƒê¸° ì„¤ì • (2ê°œ ì´ìƒì¼ ë•Œë§Œ)
            if (allWorkspaces.length > 1) {
                setupWorkspaceSelector(allWorkspaces, selectedWorkspace);
            } else {
                // 1ê°œ ì´í•˜ë©´ ì„ íƒê¸° ìˆ¨ê¹€
                document.getElementById('workspace-selector').style.display = 'none';
            }
            
            // í™”ë©´ ì •ë³´ ì—…ë°ì´íŠ¸
            const workspaceName = selectedWorkspace.name;
            const startDate = selectedWorkspace.start_date ? 
                new Date(selectedWorkspace.start_date).toLocaleDateString('ko-KR') : 
                'ì •ë³´ ì—†ìŒ';
            const workspaceId = `ws_${selectedWorkspace.name.replace(/\s+/g, '_').toLowerCase()}`;
            const memberCount = selectedWorkspace.member_count || 1;
            const isAdmin = selectedWorkspace.is_workspace_admin;
            
            // ê´€ë¦¬ì ì´ë¦„ (í˜„ì¬ ì‚¬ìš©ìê°€ ê´€ë¦¬ìì¸ ê²½ìš°)
            const adminName = isAdmin ? userData?.name || 'ì•Œ ìˆ˜ ì—†ìŒ' : 'ì™¸ë¶€ ê´€ë¦¬ì';
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            updateWorkspaceDisplay(workspaceName, adminName, startDate, workspaceId, memberCount, isAdmin);
            
            console.log('âœ… ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì • ì™„ë£Œ:', {
                name: workspaceName,
                admin: adminName,
                startDate: startDate,
                memberCount: memberCount,
                isAdmin: isAdmin
            });
        }

        // ============================
        // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„ íƒê¸° ì„¤ì • (ìˆ˜ì •ëœ ë²„ì „)
        // ============================
        function setupWorkspaceSelector(workspaces, selectedWorkspace) {
            const selector = document.getElementById('workspace-selector');
            const select = document.getElementById('workspace-select');
            
            console.log('ğŸ”§ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„ íƒê¸° ì„¤ì •:', workspaces.length, 'ê°œ');
            
            if (workspaces.length <= 1) {
                // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ê°€ 1ê°œ ì´í•˜ë©´ ì„ íƒê¸° ìˆ¨ê¹€
                selector.style.display = 'none';
                console.log('ğŸ‘ï¸ ì„ íƒê¸° ìˆ¨ê¹€ (ì›Œí¬ìŠ¤í˜ì´ìŠ¤ 1ê°œ ì´í•˜)');
                return;
            }
            
            // ì„ íƒê¸° í‘œì‹œ
            selector.style.display = 'block';
            console.log('ğŸ‘ï¸ ì„ íƒê¸° í‘œì‹œ (ì›Œí¬ìŠ¤í˜ì´ìŠ¤ 2ê°œ ì´ìƒ)');
            
            // ì˜µì…˜ ìƒì„± - API ì‘ë‹µ êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •
            select.innerHTML = workspaces.map(ws => `
                <option value="${ws.name}" ${ws.name === selectedWorkspace.name ? 'selected' : ''}>
                    ${ws.is_workspace_admin ? 'ğŸ‘‘' : 'ğŸ‘¤'} ${ws.name} (${ws.member_count || 1}ëª…)
                </option>
            `).join('');
            
            console.log('âœ… ì„ íƒê¸° ì˜µì…˜ ìƒì„± ì™„ë£Œ');
        }

        // ============================
        // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì „í™˜
        // ============================
        async function switchWorkspace() {
            const selectedName = document.getElementById('workspace-select').value;
            const selectedWorkspace = availableWorkspaces.find(ws => ws.name === selectedName);
            
            if (!selectedWorkspace) return;
            
            console.log('ğŸ”„ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì „í™˜:', selectedName);
            
            // URL ì—…ë°ì´íŠ¸ (ìƒˆë¡œê³ ì¹¨ ì—†ì´)
            const url = new URL(window.location);
            url.searchParams.set('workspace', selectedName);
            window.history.pushState({}, '', url);
            
            // í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì •
            setupCurrentWorkspace(selectedWorkspace, availableWorkspaces);
        }

        // ============================
        // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í™”ë©´ ì—…ë°ì´íŠ¸
        // ============================
        function updateWorkspaceDisplay(workspaceName, adminName, startDate, workspaceId, memberCount = 1, isAdmin = true) {
            // í‘œì‹œ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('display-workspace-name').textContent = workspaceName;
            document.getElementById('display-workspace-meta').textContent = 
                `ê´€ë¦¬ì: ${adminName} â€¢ ìƒì„±ì¼: ${startDate} â€¢ ë©¤ë²„: ${memberCount}ëª…`;
            
            // í¼ í•„ë“œ ì„¤ì •
            document.getElementById('workspace-name').value = workspaceName;
            document.getElementById('workspace-description').value = 
                `${workspaceName}ì€(ëŠ”) íŒ€ì›ë“¤ê³¼ í•¨ê»˜ í˜‘ì—…í•˜ê³  ì†Œí†µí•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. í•¨ê»˜ ì„±ì¥í•˜ê³  ë°œì „í•˜ëŠ” ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì…ë‹ˆë‹¤.`;
            
            // ì´ˆëŒ€ ê´€ë¦¬ íƒ­ì˜ ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('invite-workspace-name').value = workspaceName;
            document.getElementById('list-workspace-name').value = workspaceName;
        }

        // ============================
        // íƒ­ ì „í™˜
        // ============================
        function switchTab(tabId) {
            const tabs = document.querySelectorAll('.tab-button');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            document.getElementById(`${tabId}-tab`).classList.add('active');
            document.getElementById(`${tabId}-content`).classList.add('active');
        }

        // ============================
        // ì¼ë°˜ ì„¤ì • ì €ì¥
        // ============================
        function saveGeneralSettings() {
            const workspaceName = document.getElementById('workspace-name').value.trim();
            const workspaceDescription = document.getElementById('workspace-description').value.trim();
            
            if (!workspaceName) {
                alert('ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const spinner = document.getElementById('general-spinner');
            const btn = event.target;
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            btn.innerHTML = '<div class="loading-spinner" style="display: inline-block; margin-right: 8px;"></div>ì €ì¥ ì¤‘...';
            
            // ì‹¤ì œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìˆ˜ì • APIê°€ ì—†ìœ¼ë¯€ë¡œ ì„ì‹œ ì²˜ë¦¬
            setTimeout(() => {
                // í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ ì—…ë°ì´íŠ¸
                currentWorkspaceName = workspaceName;
                
                // í‘œì‹œ ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('display-workspace-name').textContent = workspaceName;
                document.getElementById('invite-workspace-name').value = workspaceName;
                document.getElementById('list-workspace-name').value = workspaceName;
                
                spinner.style.display = 'none';
                btn.disabled = false;
                btn.innerHTML = originalText;
                alert("âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
            }, 1000);
        }

        // ============================
        // ì´ˆëŒ€ ì½”ë“œ ìƒì„±
        // ============================
        async function generateInviteCode() {
            const workspaceName = document.getElementById('invite-workspace-name').value.trim();
            const expiresAt = document.getElementById('invite-expires-at').value;
            
            if (!workspaceName) {
                alert('ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const spinner = document.getElementById('invite-spinner');
            const btn = event.target;
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            btn.innerHTML = '<div class="loading-spinner" style="display: inline-block; margin-right: 8px;"></div>ìƒì„± ì¤‘...';
            
            try {
                const requestBody = {
                    workspace_name: workspaceName
                };
                
                if (expiresAt) {
                    requestBody.expires_at = expiresAt + ':59'; // ì´ˆ ë‹¨ìœ„ ì¶”ê°€
                }

                const result = await apiCall('/auth/invite-codes-create', {
                    method: 'POST',
                    body: JSON.stringify(requestBody)
                });

                if (result) {
                    // ìƒì„±ëœ ì½”ë“œ í‘œì‹œ
                    document.getElementById('generated-invite-code').value = result.code;
                    document.getElementById('invite-code-info').textContent = 
                        `ìƒì„±ì¼: ${new Date(result.created_at).toLocaleString('ko-KR')} â€¢ ë§Œë£Œì¼: ${result.expires_at ? new Date(result.expires_at).toLocaleString('ko-KR') : 'ë¬´ì œí•œ'}`;
                    document.getElementById('generated-invite-section').style.display = 'block';
                    
                    alert(`âœ… ìƒˆë¡œìš´ ì´ˆëŒ€ ì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ« ì½”ë“œ: ${result.code}\nğŸ“… ë§Œë£Œì¼: ${result.expires_at ? new Date(result.expires_at).toLocaleString('ko-KR') : 'ë¬´ì œí•œ'}`);
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('invite-expires-at').value = '';
                }
                
            } catch (error) {
                alert(`âŒ ì´ˆëŒ€ ì½”ë“œ ìƒì„± ì‹¤íŒ¨:\n${error.message}`);
            } finally {
                btn.disabled = false;
                spinner.style.display = 'none';
                btn.innerHTML = originalText;
            }
        }

        // ============================
        // ì´ˆëŒ€ ì½”ë“œ ëª©ë¡ ì¡°íšŒ
        // ============================
        async function loadInviteCodes() {
            const workspaceName = document.getElementById('list-workspace-name').value.trim();
            
            if (!workspaceName) {
                alert('ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const spinner = document.getElementById('list-spinner');
            const btn = event.target;
            const originalText = btn.innerHTML;
            const container = document.getElementById('invite-codes-container');
            
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            btn.innerHTML = '<div class="loading-spinner" style="display: inline-block; margin-right: 8px;"></div>ì¡°íšŒ ì¤‘...';
            
            try {
                const codes = await apiCall('/auth/invite-codes-list', {
                    method: 'POST',
                    body: JSON.stringify({
                        workspace_name: workspaceName
                    })
                });

                if (codes && codes.length > 0) {
                    container.innerHTML = `
                        <div style="margin-bottom: 16px; padding: 12px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #3b82f6;">
                            <strong>ğŸ“Š í†µê³„:</strong> ì´ ${codes.length}ê°œì˜ ì´ˆëŒ€ ì½”ë“œ â€¢ ${codes.filter(c => c.used).length}ê°œ ì‚¬ìš©ë¨ â€¢ ${codes.filter(c => !c.used).length}ê°œ ë¯¸ì‚¬ìš©
                        </div>
                        ${codes.map(code => `
                            <div style="
                                border: 2px solid ${code.used ? '#10b981' : '#f59e0b'}; 
                                border-radius: 12px; 
                                padding: 16px; 
                                margin-bottom: 12px;
                                background: white;
                            ">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 600; color: #1e293b; font-size: 18px;">
                                            ğŸ« ${code.code}
                                        </div>
                                        <div style="font-size: 14px; color: #64748b; margin-top: 8px;">
                                            <span style="background: ${code.used ? '#dcfce7' : '#fef3c7'}; color: ${code.used ? '#166534' : '#92400e'}; padding: 2px 8px; border-radius: 4px; font-weight: 600;">
                                                ${code.used ? 'âœ… ì‚¬ìš©ë¨' : 'â³ ë¯¸ì‚¬ìš©'}
                                            </span>
                                            <span style="margin-left: 12px;">
                                                ğŸ“… ë§Œë£Œ: ${code.expires_at ? new Date(code.expires_at).toLocaleDateString('ko-KR') : 'ë¬´ì œí•œ'}
                                            </span>
                                        </div>
                                    </div>
                                    <button onclick="copyToClipboard('${code.code}')" style="
                                        padding: 8px 16px; 
                                        background: #3b82f6; 
                                        color: white; 
                                        border: none; 
                                        border-radius: 6px; 
                                        cursor: pointer;
                                        font-weight: 500;
                                    ">ğŸ“‹ ë³µì‚¬</button>
                                </div>
                            </div>
                        `).join('')}
                    `;
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #64748b; border: 2px dashed #e2e8f0; border-radius: 12px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ«</div>
                            <h3>ìƒì„±ëœ ì´ˆëŒ€ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>"${workspaceName}" ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ëŒ€í•œ ì´ˆëŒ€ ì½”ë“œë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ef4444; border: 2px solid #fecaca; border-radius: 12px; background: #fef2f2;">
                        <div style="font-size: 48px; margin-bottom: 16px;">âŒ</div>
                        <h3>ì´ˆëŒ€ ì½”ë“œ ì¡°íšŒ ì‹¤íŒ¨</h3>
                        <p>${error.message}</p>
                        <button onclick="loadInviteCodes()" style="margin-top: 16px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">ë‹¤ì‹œ ì‹œë„</button>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                spinner.style.display = 'none';
                btn.innerHTML = originalText;
            }
        }

        // ============================
        // ì´ˆëŒ€ ì½”ë“œ ë³µì‚¬
        // ============================
        function copyInviteCode() {
            const code = document.getElementById('generated-invite-code').value;
            copyToClipboard(code);
        }

        function copyToClipboard(text) {
            if (!text) {
                alert('âš ï¸ ë³µì‚¬í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    const btn = event.target;
                    const originalText = btn.textContent;
                    
                    btn.textContent = 'âœ… ë³µì‚¬ì™„ë£Œ!';
                    btn.style.background = 'linear-gradient(135deg, #059669, #047857)';
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.background = '';
                    }, 2000);
                });
            } else {
                // í´ë°± ë°©ë²•
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert(`ğŸ“‹ "${text}" ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            }
        }

        // ============================
        // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‚­ì œ
        // ============================
        function deleteWorkspace() {
            if (confirm("âš ï¸ ì •ë§ë¡œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
                if (confirm("ğŸš¨ ë§ˆì§€ë§‰ í™•ì¸: ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤.")) {
                    // ì‹¤ì œ ì‚­ì œ API í˜¸ì¶œ (í˜„ì¬ëŠ” ì•Œë¦¼ë§Œ)
                    alert("ğŸ—‘ï¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‚­ì œ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.\nì‹¤ì œë¡œëŠ” DELETE /workspaces/{id} APIê°€ í•„ìš”í•©ë‹ˆë‹¤.");
                    // window.location.href = '/';
                }
            }
        }

        // ============================
        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        // ============================
        document.addEventListener('keydown', function(e) {
            // ESC í‚¤ë¡œ ëª¨ë“  ëª¨ë‹¬ ë‹«ê¸°
            if (e.key === 'Escape') {
                // ëª¨ë‹¬ì´ ìˆë‹¤ë©´ ë‹«ê¸° ë¡œì§ ì¶”ê°€
            }
            
            // Ctrl + 1,2,3: íƒ­ ì „í™˜
            if (e.ctrlKey) {
                switch (e.key) {
                    case '1':
                        e.preventDefault();
                        switchTab('general');
                        break;
                    case '2':
                        e.preventDefault();
                        switchTab('invite');
                        break;
                    case '3':
                        e.preventDefault();
                        switchTab('danger');
                        break;
                }
            }
        });

        // ============================
        // ê°œë°œì ë„êµ¬ìš© ë””ë²„ê¹…
        // ============================
        window.debugSettings = {
            generateTestInvite: () => generateInviteCode(),
            loadTestCodes: () => loadInviteCodes(),
            refreshWorkspaces: () => loadWorkspaceInfo(),
            switchToWorkspace: (name) => {
                const url = new URL(window.location);
                url.searchParams.set('workspace', name);
                window.location.href = url.toString();
            },
            fillTestData: () => {
                document.getElementById('workspace-name').value = 'í…ŒìŠ¤íŠ¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤';
                document.getElementById('workspace-description').value = 'í…ŒìŠ¤íŠ¸ìš© ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì…ë‹ˆë‹¤.';
                document.getElementById('invite-workspace-name').value = 'í…ŒìŠ¤íŠ¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤';
                document.getElementById('list-workspace-name').value = 'í…ŒìŠ¤íŠ¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤';
            },
            switchToTab: (tab) => switchTab(tab),
            getUserData: () => userData,
            getCurrentWorkspace: () => currentWorkspaceName,
            getAvailableWorkspaces: () => availableWorkspaces
        };
        
        console.log('ğŸ”§ ê°œë°œì ë„êµ¬ì—ì„œ debugSettings ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        console.log('ì˜ˆ: debugSettings.generateTestInvite(), debugSettings.fillTestData()');
    </script>
</body>
</html>